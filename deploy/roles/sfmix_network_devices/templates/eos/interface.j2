#jinja2: lstrip_blocks: True
interface {{ interface.name }}
{% if interface.link_peers is defined and interface.link_peers | length %}
   !! Cabled: {% for cable_far_end in interface.link_peers %} {{ cable_far_end.device.name }}/{{ cable_far_end.name }} {% endfor %}

{% endif %}
{% if interface.description is defined and interface.description|length %}
   description {{ interface.description }}
{% endif %}
{% if interface.speed == 1000000 %}
speed forced 1000full
{% endif %}
{% if interface.mode and not interface.lag %}
{%   if interface.mode.value == "access" %}
   switchport mode access
{%   elif interface.mode.value == "trunk" %}
   switchport mode trunk
{%     if interface.untagged_vlan %}
   switchport trunk native vlan {{ interface.untagged_vlan.vid }}
{%     endif %}
{%     if interface.tagged_vlans %}
   switchport trunk allowed vlan {{ interface.tagged_vlans | selectattr('vid') | join(',') }}
{%     endif%}
{% endif %}
{% endif %}
{% if interface.lag is defined and interface.lag.name is defined %}
   no switchport
   channel-group {{ interface.lag.name | replace("Port-Channel", "") }} mode active
{% endif %}
{% if 'peering_port' in interface.tags %}
   switchport port-security mac-address maximum 3
   switchport port-security
   storm-control broadcast level 0.01
   storm-control multicast level 0.01
   storm-control unknown-unicast level 0.01
   spanning-tree bpduguard enable
{% endif %}
{% if interface.name == "Vxlan1" %}
  vxlan source-interface Loopback0
  vxlan udp-port 4789
  vxlan flood vtep {{ other_peering_switch_loopbacks | join(" ") }}
{% endif %}
