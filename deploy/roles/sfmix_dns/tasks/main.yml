---
- name: Create /etc/bind/zones
  become: true
  ansible.builtin.file:
    dest: /etc/bind/zones
    state: directory
    mode: ug=rwx,o=rx

- name: Place sfmix_zones.conf
  become: true
  notify: Restart named.service
  ansible.builtin.template:
    src: sfmix_zones.conf.j2
    dest: /etc/bind/sfmix_zones.conf
    mode: ug=rw,o=r

- name: Check for existing dynamic zone files
  ansible.builtin.stat:
    path: "/var/lib/bind/{{ item }}"
  loop: "{{ sfmix_dynamic_zone_files }}"
  register: dynamic_zone_files_stat

- name: Add all Initial Dynamic DNS zone files
  ansible.builtin.template:
    src: "{{ item.item }}.j2"
    dest: "/var/lib/bind/{{ item.item }}"
    owner: root
    group: bind
    mode: ug=rw,o=r
  loop: "{{ dynamic_zone_files_stat.results }}"
  when: "not item.stat.exists"
  notify: Restart named.service

- name: Place all DNS zone files
  notify: Restart named.service
  ansible.builtin.template:
    src: "{{ item }}.j2"
    dest: "/etc/bind/zones/{{ item }}"
    mode: ug=rw,o=r
  with_items: "{{ sfmix_zone_files }}"
